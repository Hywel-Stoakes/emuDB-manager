<h1 class="page-header">Database: {{database?.name}}</h1>

<p>
	<a class="btn btn-primary" [href]="webAppLink" target="_blank">EMU-webApp</a>
</p>

<hr>

<p>
	URL to EMU-webApp: {{webAppLink}}
</p>

<hr>

<div class="panel panel-default">

	<ul class="panel-body nav nav-pills nav-justified">
		<li role="presentation" [ngClass]="{active: state === 'BundleLists'}">
			<a (click)="state = 'BundleLists'">
				Bundle lists <span class="badge">{{database?.bundleLists?.length}}</span>
			</a>
		</li>
		<li role="presentation" [ngClass]="{active: state === 'Sessions'}">
			<a (click)="state = 'Sessions'">
				Sessions <span class="badge">{{database?.sessions?.length}}</span>
			</a>
		</li>
		<li role="presentation" [ngClass]="{active: state === 'Download'}">
			<a (click)="state = 'Download'">
				Download database
			</a>
		</li>
		<li role="presentation" [ngClass]="{active: state === 'Rename'}">
			<a (click)="state = 'Rename'">
				Rename database
			</a>
		</li>
	</ul>


	<emudbmanager-bundle-lists-overview *ngIf="state === 'BundleLists'" [database]="database?.name">
	</emudbmanager-bundle-lists-overview>


	<div *ngIf="state === 'Sessions'" class="table-responsive">
		<table class="table table-striped">
			<thead>
			<tr>
				<th>Name</th>
				<th>Bundles</th>
			</tr>
			</thead>

			<tbody>
			<tr *ngFor="let session of database?.sessions">
				<td>{{session.name}}</td>
				<td>{{session.bundles.length}}</td>
			</tr>
			</tbody>
		</table>
	</div>

	<div *ngIf="state === 'Download'" class="panel-body">
		<p>
			Every change to a database is recorded (using the software git).
		</p>
		<p>
			It is possible to create and download a ZIP file containing the databaseâ€™s state at any
			point in time.
		</p>

		<ul>
			<li *ngFor="let month of commitListing">
				<a (click)="month.open = !month.open">
					<span [ngClass]="{
						'glyphicon': true,
						'glyphicon-collapse-down': !month.open,
						'glyphicon-collapse-up': month.open
					}"></span>

					{{month.month}}
				</a>

				<ul *ngIf="month.open">
					<li *ngFor="let day of month.days">
						<a (click)="day.open = !day.open">
							<span [ngClass]="{
								'glyphicon': true,
								'glyphicon-collapse-down': !day.open,
								'glyphicon-collapse-up': day.open
							}"></span>

							{{day.day}}
						</a>

						<ul *ngIf="day.open">
							<li *ngFor="let commit of day.commits">
								<button class="btn btn-primary btn-xs">
									Download
								</button>
								{{commit.dateTime}}: {{commit.message}}
							</li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</div>

	<div *ngIf="state === 'Rename'" class="panel-body">
		<form (ngSubmit)="renameDatabase()">
			<p>
				Current name of the database: {{database?.name}}
			</p>

			<p>
				<input class="form-control" placeholder="New name" [(ngModel)]="newName"
				       name="newName" autocomplete="off">
			</p>

			<p *ngIf="renameSuccess" class="alert alert-success">
				<button type="button" class="close" aria-label="Close" (click)="renameSuccess = ''">
					<span aria-hidden="true">&times;</span>
				</button>

				{{renameSuccess}}
			</p>

			<p *ngIf="renameError" class="alert alert-danger">
				<button type="button" class="close" aria-label="Close" (click)="renameError = ''">
					<span aria-hidden="true">&times;</span>
				</button>

				{{renameError}}
			</p>

			<p>
				<button type="submit" class="btn btn-default">Rename</button>
			</p>
		</form>
	</div>

</div>
